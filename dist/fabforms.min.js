function validateForm(e,t){$(".form-item .error-message",$(e)).remove(),$(".form-item.error",$(e)).removeClass("error");var a=formToJson(e),r=!0;for(var i in t){var s=$(".form-item-input."+i,e).data("disablevalidation")||!1;if(!s&&t[i].required){var n=$.trim(a[i]),l=$(".form-item."+i,$(e));"select"===t[i].type&&"placeholder"===n&&(t[i].error?l.addClass("error").prepend('<div class="error-message">'+t[i].error+"</div>"):l.addClass("error").prepend('<div class="error-message">Please select an option</div>'),r=!1),(n&&-1===n.indexOf("Eg:")||"user_title"===i)&&n!==$("#"+i,e).attr("placeholder")?t[i].datatype&&!checkRule(t[i].datatype,n)?(l.addClass("error").prepend('<div class="error-message">'+t[i].datatype.message+"</div>"),r=!1):t[i].maxlength&&n.length>t[i].maxlength&&(l.addClass("error").prepend('<div class="error-message">Should not be more than '+t[i].maxlength+" chars</div>"),r=!1):(l.addClass("error").prepend('<div class="error-message">This field is required</div>'),r=!1)}}return r}function validateField(e,t){var a=$(e).attr("name"),r=$.trim($(e).val());return $(e).siblings(".error-message").remove(),$(e).closest(".form-item").removeClass("error"),""!==r&&t[a].datatype&&!checkRule(t[a].datatype,r)?($(".form-item."+a,$(e).closest("form")).addClass("error").prepend('<div class="error-message">'+t[a].datatype.message+"</div>"),!1):""!==r&&t[a].maxlength&&r.length>t[a].maxlength?($(".form-item."+a,$(e).closest("form")).addClass("error").prepend('<div class="error-message">Should not be more than '+t[a].maxlength+" chars</div>"),!1):!0}function checkRule(e,t){switch(e.type){case"number":if(!isNumber(t))return!1;break;case"email":if(!looksLikeEmail(t))return!1;break;case"creditcard":if(!isCreditCard(t))return!1;break;case"name":if(!isFullName(t))return!1;break;case"title":if(1>t)return!1;break;case"comboid":if(1>t)return!1;break;case"chars":if(!charactersOnly(t))return!1;break;case"debitcard":var a=RegExp(/\s/g);if(a.test($("#card-number","#debit-card").val()))return!1}return e.length&&t.length!==e.length?!1:!0}function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function isFullName(e){return-1!==$.trim(e).indexOf(" ")}function charactersOnly(e){return-1===e.search(/\d/g)}function looksLikeEmail(e){var t=RegExp(/^\S+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-\.]+$/);return t.test(e)}function isCreditCard(e){if(e.length>19)return!1;var t=zovi.util.findCardType(e);if((1===t||2===t)&&16!==e.length)return!1;for(var a,r,i=0,s=1,n=e.length,l=0;n>l;l++)a=e.substring(n-l-1,n-l),r=parseInt(a,10)*s,i+=r>=10?r%10+1:r,s=1===s?2:1;return 0===i%10}(function(e){e.fn.serializeJSON=function(){var t={};return e.map(e(this).serializeArray(),function(e){t[e.name]=e.value}),t},getformItemHTML=function(e,t,a){var r=t[e]["default"]||"";a=a||r||"";var i=t[e].klass,s=t[e].placeholder||"",n=t[e].datatype&&t[e].datatype.type||t[e].type,l=t[e].disableValidation||!1,o=t[e].onValue||1;t[e].offValue||0;var m=["form-item"];m.push(e),i&&m.push(i),m.push(t[e].type),html='<div class="'+m.join(" ")+'">',_.isUndefined(t[e].label)||(html+='<label for="'+e+'">'+t[e].label+"</label>"),t[e].required&&(html+='<div class="required">*</div>'),html+='<span class="'+e+'" item-type="'+t[e].type+'">'+a+"</span>";var d,c=' data-disablevalidation="{{disableValidation}}" data-datatype="{{datatype}}" class="{{class}}" name="{{name}}"';switch(t[e].type){case"hidden":html+='<input type="hidden"'+c+' value="{{value}}">',d=[e];break;case"text":html+=['<input type="text"'+c+' value="{{value}}" placeholder="',s,'" size="30" maxlength="',t[e].maxlength,'">'].join(""),d=["form-item-input","text",e];break;case"password":html+=['<input type="password"'+c+' value="{{value}}" placeholder="',s,'" size="30" maxlength="',t[e].maxlength,'">'].join(""),d=["form-item-input","text","password",e];break;case"textarea":html+=["<textarea"+c+' placeholder="',s,'">{{value}}</textarea>'].join(""),d=["form-item-input","textarea",e];break;case"check":html+=['<input type="checkbox"'+c+' value="'+o+'" ',a===o?'checked="checked" ':"",">"].join(""),d=["form-item-input","checkbox",e];break;case"static":html+=['<input type="text"'+c+' value="{{value}}" disabled size="30">'].join(""),d=["form-item-input","text","static",e];break;case"editable-combo":html+=['<input type="text"'+c+' value="{{value}}" placeholder="',s,'" size="30" maxlength="',t[e].maxlength,'">'].join(""),d=["form-item-input","editable-combo-input",e];break;case"select":html+="<select"+c+">";var u,p=t[e].options,h=function(e){return e===Object(e)};for(var v in p){var f=p[v];h(f)?(u=f.value===a?" selected":"",html+="<option"+u+' value="'+f.value+'">'+f.text+"</option>"):(u=f===a?" selected":"",html+="<option"+u+' value="'+f+'">'+f+"</option>")}html+="</select>",d=["form-item-input",e];break;case"image":html+=['<img class="form-item-input image ',e,'" name="',e,'" src="',a,'">'].join(""),d=[];break;case"html":html+=t[e].value,d=[];break;default:log("Problem with json: "+settings.service.url+" : "+t[e].label)}return html+="</div>",html=html.replace("{{disableValidation}}",l),html=html.replace("{{datatype}}",n),html=html.replace("{{class}}",d.join(" ")),html=html.replace("{{name}}",e),html=html.replace("{{value}}",a)},getFormHTML=function(e,t,a){var r="";r+="<header><span>"+a.title+"</span></header>",r+='<form action="'+a.service.url+'" method="POST">';for(var i in t)r+=getformItemHTML(i,t,e&&e[i]);return r+='<div class="form-item submit">',r+='<a href="javascript:void(0);" class="cancel">cancel</a>',e&&e.editable&&e.editable>0&&(r+='<a href="javascript:void(0);" class="delete-link">delete</a>',r+='<a href="javascript:void(0);" class="edit-link">edit</a>'),r+='<button class="blue awesome" type="submit">'+(a.submitText||"Submit")+"</button>",r+='<a href="javascript:void(0);" class="edit-link add">Add new '+a.title+"</a>",r+="</div></form>"},e.fn.renderEditableData=function(t,a,r){var i={title:"",submitText:"Submit",loaderText:"Saving..."};Array.isArray||function(e){return"[object Array]"==toString.call(e)},r=e.extend({},i,r);var s=e('<div class="editable '+(t?"current":"new")+'">'),n=getFormHTML(t,a,r);return s.append(n),e(this).append(s),e("input:text, textarea, select",s).blur(function(){validateField(this,a)}),e("form",s).submit(function(){var i=this;if(validateForm(this,a)){e(".form-error-message",i).remove(),e(".submit button",i).spinner({position:r.spinnerPosition||"left"});var n=e(i).serializeJSON();if(r.dataTransform&&(n=r.dataTransform(n,s)),r.submit)return r.submit(i,n);r.beforeAjax&&r.beforeAjax(i,n),zovi.ajax({type:t?"PUT":"POST",service:r.service,data:JSON.stringify(n)}).done(function(t){r.done&&r.done(t,n),e(".submit button",i).spinner("remove")}).fail(function(t){if(r.fail&&r.fail(t,i),r.errorMessageHandler){var a=r.errorMessageHandler(t,i);e(i).append('<div class="form-error-message">'+a+"</div>")}e(".submit button",i).spinner("remove")})}return!1}),e(s).on("keydown",".form-item .form-item-input",function(t){("number"===e(this).data("datatype")||"creditcard"===e(this).data("datatype"))&&zovi.util.allowOnlyDigits(t)}),e("input, textarea").placeholder(),e(this)},e.fn.renderNewForm=function(t,a){return e(this).renderEditableData(void 0,t,a)},e(".edit-link, .cancel",".editable").on("click",function(){return e(".form-item .error-message").remove(),e(".form-item.error").removeClass("error"),e(this).closest(".editable").toggleClass("editing"),!1})})(jQuery);var VD={phone:{type:"number",length:10,message:"Enter a 10 digit mobile number without '0' as prefix"},email:{type:"email",message:"Enter a valid email address"},pincode:{type:"number",length:6,message:"Enter a 6 digit pincode"},cvv:{type:"number",length:3,message:"Enter 3 digit CVV number on back of your card"},creditcard:{type:"creditcard",message:"Enter a valid card number"},debitcard:{type:"debitcard",message:"Enter card number without spaces"},name:{type:"name",message:"Please enter first and last name"},title:{type:"title",message:"Select"},comboid:{type:"comboid",message:"Select an option"},ifscode:{length:11,message:"Enter 11 characters"},loyaltypin:{length:6,message:"Enter 6 digit pin"},loyaltynumber:{type:"number",length:16,message:"Enter 16 digit Card Number"},chars:{type:"chars",message:"Enter name without digits."}};